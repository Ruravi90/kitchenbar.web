import{b as me,c as pe,d as _e,g as ue,h as ge,i as he,j as ve,l as fe}from"./chunk-6MCH4QGB.js";import"./chunk-BQVHG75P.js";import{a as ae,l as ce,n as de}from"./chunk-OSNXDCNO.js";import"./chunk-QFKRZ7EC.js";import{b as oe,c as se}from"./chunk-GQ2UZOTQ.js";import{b as G,d as H,g as U,j as $,l as ee,m as te,n as ie,p as ne,q as re,t as le}from"./chunk-5C42LTVV.js";import"./chunk-4YRY4IP2.js";import{e as X,g as J,l as K}from"./chunk-IDCO3KAE.js";import{$a as N,Aa as M,Ba as S,C as m,D as p,Ea as y,Fa as V,Ga as R,Ka as O,La as E,P as r,Q as g,Y as h,_ as a,_a as W,ab as P,ba as x,da as o,db as z,ea as s,fa as v,g as q,ja as w,ka as f,la as c,qa as j,qb as Q,sb as Y,t as T,tb as Z,va as L,vb as F,wa as u,x as B,xa as A,y as k,ya as D,za as I}from"./chunk-LVDDLAXI.js";var C=()=>({width:"100%"}),Ae=t=>({"p-3":t}),ye=t=>({"button-flash":t}),Te=(t,d)=>({"border-top-1 surface-border":t,"item-cancel":d});function ke(t,d){t&1&&(o(0,"div"),v(1,"p-skeleton",15)(2,"p-skeleton",16)(3,"p-skeleton",17)(4,"p-skeleton",18)(5,"p-skeleton",19),s())}function Ve(t,d){if(t&1&&(o(0,"div",32)(1,"div",33),u(2),s(),o(3,"div",34),u(4),O(5,"currency"),s()()),t&2){let e=d.$implicit;r(2),A(e.name),r(2),A(E(5,2,e.price))}}function Oe(t,d){if(t&1){let e=w();o(0,"div",26)(1,"div",27)(2,"p-autoComplete",28),S("ngModelChange",function(i){m(e);let l=c(2);return M(l.selectedItem,i)||(l.selectedItem=i),p(i)}),f("onFocus",function(i){m(e);let l=c(2);return p(l.focusSearchMeal(i))})("completeMethod",function(i){m(e);let l=c(2);return p(l.searchMeal(i))})("onSelect",function(i){m(e);let l=c(2);return p(l.completeSelectMeal(i))}),h(3,Ve,6,4,"ng-template",29),s()(),o(4,"div",30)(5,"p-inputNumber",31),S("ngModelChange",function(i){m(e);let l=c(2);return M(l.order.quantity,i)||(l.order.quantity=i),p(i)}),s()()()}if(t&2){let e=c(2);r(2),x(y(14,C)),a("inputStyle",y(15,C)),I("ngModel",e.selectedItem),a("suggestions",e.suggestionsMeal)("dropdown",!0),r(3),x(y(16,C)),a("inputStyle",y(17,C)),I("ngModel",e.order.quantity),a("showButtons",!0)("step",1)("min",1)("max",100)}}function Ee(t,d){if(t&1){let e=w();o(0,"div",26)(1,"div",27)(2,"textarea",35),S("ngModelChange",function(i){m(e);let l=c(2);return M(l.order.aditional,i)||(l.order.aditional=i),p(i)}),u(3,"                    "),s()(),o(4,"div",30)(5,"button",36),f("click",function(){m(e);let i=c(2);return p(i.addOrder())}),s()()()}if(t&2){let e=c(2);r(2),x(y(4,C)),a("autoResize",!0),I("ngModel",e.order.aditional)}}function qe(t,d){t&1&&(o(0,"div",38),v(1,"p-button",42),s()),t&2&&(r(),x(y(3,C)),a("raised",!0))}function Le(t,d){if(t&1){let e=w();o(0,"div",26),h(1,qe,2,4,"div",37),o(2,"div",38)(3,"p-button",39),f("click",function(){m(e);let i=c(2);return p(i.requestAttendace())}),s()(),o(4,"div",40)(5,"p-button",41),f("click",function(){m(e);let i=c(2);return p(i.requestCheck())}),s()()()}if(t&2){let e=c(2);r(),a("ngIf",!1),r(2),x(y(9,C)),a("raised",!0)("ngClass",V(10,ye,e.table==null?null:e.table.isRequestAttendace)),r(2),x(y(12,C)),a("raised",!0)("ngClass",V(13,ye,e.table==null?null:e.table.isRequestCheck))}}function De(t,d){t&1&&v(0,"img",58)}function Fe(t,d){t&1&&v(0,"img",59)}function Be(t,d){t&1&&v(0,"img",60)}function je(t,d){t&1&&v(0,"img",61)}function Re(t,d){t&1&&v(0,"img",62)}function We(t,d){if(t&1){let e=w();o(0,"div",56)(1,"p-button",63),f("onClick",function(i){m(e);let l=c().$implicit,b=c(3);return p(b.changeStatusOrder(i,l))}),s()()}if(t&2){let e=c().$implicit;r(),a("disabled",e.statusOrderId!=3)}}function Ne(t,d){if(t&1){let e=w();o(0,"div",56)(1,"p-button",64),f("onClick",function(){m(e);let i=c().$implicit,l=c(3);return p(l.confirmCancel(i))}),s()()}if(t&2){let e=c().$implicit;r(),a("disabled",e.isCancel||e.statusOrderId>=3)}}function Pe(t,d){if(t&1&&(o(0,"div",48)(1,"div",49)(2,"div",34),h(3,De,1,0,"img",50)(4,Fe,1,0,"img",51)(5,Be,1,0,"img",52)(6,je,1,0,"img",53)(7,Re,1,0,"img",54),s(),o(8,"div",33)(9,"div",55),u(10),s()(),o(11,"div",56)(12,"div",55),u(13),O(14,"currency"),s()(),h(15,We,2,1,"div",57)(16,Ne,2,1,"div",57),s()()),t&2){let e=d.$implicit,n=d.first,i=c(3);r(),a("ngClass",R(12,Te,!n,e.isCancel)),r(2),a("ngIf",e.isCancel),r(),a("ngIf",e.statusOrderId==1&&!e.isCancel),r(),a("ngIf",e.statusOrderId==2&&!e.isCancel),r(),a("ngIf",e.statusOrderId==3&&!e.isCancel),r(),a("ngIf",e.statusOrderId==4&&!e.isCancel),r(3),A(e.quantity+" "+(e.meal==null?null:e.meal.name)),r(3),A(E(14,10,(e.meal==null?null:e.meal.price)*e.quantity)),r(2),a("ngIf",i.isLogin),r(),a("ngIf",i.isLogin)}}function ze(t,d){if(t&1){let e=w();o(0,"p-button",65),f("onClick",function(){m(e);let i=c(3);return p(i.confirmCloseTicket())}),u(1,"Cerrar cuenta"),s()}}function Ge(t,d){if(t&1&&(o(0,"div",43),h(1,Pe,17,15,"div",44),o(2,"div",45)(3,"div",32)(4,"div",33)(5,"div",46),u(6),O(7,"currency"),s()(),o(8,"div",34),h(9,ze,2,0,"p-button",47),s()()()()),t&2){let e=d.$implicit,n=c(2);r(),a("ngForOf",e),r(5),D("Total: ",E(7,3,n.totalOrder)," MXN"),r(3),a("ngIf",n.isLogin)}}function He(t,d){if(t&1&&(o(0,"div",20)(1,"div",21)(2,"p-card",22),h(3,Oe,6,18,"div",23)(4,Ee,6,5,"div",23)(5,Le,6,15,"div",23),o(6,"p-dataView",24,1),h(8,Ge,10,5,"ng-template",25),s()()()()),t&2){let e=c();r(),a("ngClass",V(12,Ae,!e.isLogin)),r(),x(y(14,C)),j("header","Mesa ",e.table==null?null:e.table.name," a nombre de ",e.diner.name_client,""),r(),a("ngIf",e.isLogin),r(),a("ngIf",e.isLogin),r(),a("ngIf",!e.isLogin),r(),a("value",e.items)("rows",10)("paginator",!0)}}function Ue(t,d){if(t&1){let e=w();o(0,"div",66)(1,"div",67),v(2,"i",68),s(),o(3,"span",69),u(4),s(),o(5,"p",70),u(6),s(),o(7,"div",71)(8,"button",72),f("click",function(){m(e),c();let i=L(4);return p(i.accept())}),s(),o(9,"button",73),f("click",function(){m(e),c();let i=L(4);return p(i.reject())}),s()()()}if(t&2){let e=d.$implicit;r(4),D(" ",e.header," "),r(2),A(e.message)}}var Ce=(()=>{class t{constructor(e,n,i,l,b,_,we,Ie,Me,Se){this.confirmationService=e,this.messageService=n,this._serviceAuth=i,this._serviceTable=l,this._serviceOrder=b,this._serviceDiner=_,this._serviceMeal=we,this.route=Ie,this.router=Me,this.hub=Se,this.skeleton=!0,this.items=[],this.order={},this.isLogin=!1,this.totalOrder=0,this.isRequestAttendace=!1,this.isRequestCheck=!1,this.diner={name_client:"Cliente an\xF3nimo"},this.suggestionsMeal=[],this.meals=[],this.tableIdentity="",this.instanceIdentity="",this.showModalDiner=!1,this.isLogin=i.checkLogin()}ngOnInit(){return q(this,null,function*(){this.order.quantity=1,this.order.statusOrderId=1,yield this.delay(1e3),this.tableIdentity=this.route.snapshot.paramMap.get("identity"),this.isLogin||(this.hub.connect(),yield this.delay(1e3),this.hub.newUser().subscribe()),this.getTable(),this.getDiner(),this.isLogin&&this.getMeals(),this.hub.receiveOrderFromTable().subscribe(e=>{"number".includes(typeof this.diner.id)||(this.getDiner(),this.delay(1e3)),this.getOrders()})})}ngOnDestroy(){}delay(e){return q(this,null,function*(){return new Promise(n=>setTimeout(n,e))})}getTable(){this._serviceTable.getByIdentity(this.tableIdentity).subscribe({next:e=>{console.log(e),this.table=e,this.instanceIdentity=e.instance.identity,this.isLogin||this.hub.joinGroupAnonymus(e.instance.identity)},error:e=>{console.log(e),this.messageService.add({severity:"warn",summary:"Alerta",detail:e.error.messages})}})}getOrders(){this.totalOrder=0,this._serviceOrder.getItemsByTable(this.diner.id).subscribe({next:e=>{this.items=e,this.items.forEach(n=>{n.isCancel||(this.totalOrder+=n.meal.price*n.quantity)}),this.skeleton=!1},error:e=>{console.log(e),this.messageService.add({severity:"warn",summary:"Alerta",detail:e.error.messages})}})}getDiner(){this._serviceDiner.getItemsByTable(this.tableIdentity).subscribe({next:e=>{e==null&&this.isLogin?(this.showModalDiner=!0,this.skeleton=!1):(this.diner=e,this.getOrders())},error:e=>{console.log(e),this.messageService.add({severity:"warn",summary:"Alerta",detail:e.error.messages})}})}getMeals(){this._serviceMeal.getItemsByInstance().subscribe({next:e=>{this.meals=e},error:e=>{console.log(e),this.messageService.add({severity:"warn",summary:"Alerta",detail:e.error.messages})}})}requestAttendace(){this.table.isRequestCheck=!1,this.table.isRequestAttendace=!this.table.isRequestAttendace,this._serviceTable.request(this.table).subscribe({next:()=>{this.hub.sendNotificationTables(this.table)},error:e=>{console.log(e),this.messageService.add({severity:"warn",summary:"Alerta",detail:e.error.messages})}})}requestCheck(){this.table.isRequestCheck=!this.table.isRequestCheck,this.table.isRequestAttendace=!1,this._serviceTable.request(this.table).subscribe({next:()=>{this.hub.sendNotificationTables(this.table)},error:e=>{console.log(e),this.messageService.add({severity:"warn",summary:"Alerta",detail:e.error.messages})}})}focusSearchMeal(e){}searchMeal(e){let n=[],i=e.query;for(let l=0;l<this.meals.length;l++){let b=this.meals[l];b.name.toLowerCase().indexOf(i.toLowerCase())==0&&n.push(b)}this.suggestionsMeal=n}completeSelectMeal(e){this.order={mealId:e.value.id,tableId:this.table?.id,statusOrderId:1,quantity:1}}addOrder(){this.selectedItem&&(this.order.dinerId=this.diner.id,this._serviceOrder.createItem(this.order).subscribe({next:e=>{this.hub.sendOrder(this.order),this.order={},this.order.dinerId=this.diner.id,this.order.quantity=1,this.selectedItem=void 0},error:e=>{console.log(e),this.messageService.add({severity:"warn",summary:"Alerta",detail:e.error.messages})}}))}cancelOrder(e){e.isCancel=!0,this._serviceOrder.updateItem(e.id,e).subscribe({next:n=>{this.hub.sendOrder(e)},error:n=>{console.log(n),this.messageService.add({severity:"warn",summary:"Alerta",detail:n.error.messages})}})}confirmCancel(e){this.confirmationService.confirm({header:"Estas seguro de cancelar?",message:"Por favor de confirmar.",accept:()=>{this.cancelOrder(e)}})}changeStatusOrder(e,n){this.confirmationService.confirm({target:e.target,message:"",header:"Se entrego el alimento?",accept:()=>{n.statusOrderId=4,this._serviceOrder.updateItem(n.id,n).subscribe({next:i=>{this.hub.sendOrder(n)},error:i=>{console.log(i),this.messageService.add({severity:"warn",summary:"Alerta",detail:i.error.messages})}})}})}confirmCloseTicket(){this.confirmationService.confirm({header:"Estas seguro de cerrar la cuenta?",message:"Por favor de confirmar.",accept:()=>{this._serviceDiner.closeTicket(this.diner.id).subscribe({next:e=>{this.router.navigate(["/kitchen/tables"])},error:e=>{console.log(e),this.messageService.add({severity:"warn",summary:"Alerta",detail:e})}})}})}saveDiner(){this.table!=null&&(this.diner.tableId=this.table.id,this._serviceDiner.createItem(this.diner).subscribe({next:e=>{this.showModalDiner=!1},error:e=>{this.showModalDiner=!0,console.log(e),this.messageService.add({severity:"warn",summary:"Alerta",detail:e.error.messages})}}))}static{this.\u0275fac=function(n){return new(n||t)(g(X),g(J),g($),g(ie),g(te),g(re),g(ee),g(Q),g(Y),g(ne))}}static{this.\u0275cmp=B({type:t,selectors:[["app-attendace"]],decls:19,vars:10,consts:[["cd",""],["dv",""],[4,"ngIf"],["class","flex flex-wrap justify-content-center ",4,"ngIf"],["pTemplate","headless"],["header","Cliente","closable","false",3,"visibleChange","modal","visible"],[1,"formgrid","grid","gap-3","mb-3","mt-3"],[1,"field","col-12"],["for","name"],["pInputText","","id","name","type","text",1,"w-full",3,"ngModelChange","ngModel"],["for","phone"],["id","phone","mask","99-9999-9999","placeholder","99-9999-9999",3,"ngModelChange","ngModel"],[1,"flex","justify-content-end","gap-2"],["label","Cancelar","severity","secondary",3,"routerLink"],["label","Guardar",3,"click"],["styleClass","mb-2"],["width","10rem","styleClass","mb-2"],["width","5rem","styleClass","mb-2"],["width","2rem","styleClass","mb-2"],["width","10rem","height","4rem","styleClass","mb-2"],[1,"flex","flex-wrap","justify-content-center"],[1,"w-full",3,"ngClass"],[3,"header"],["class","formgroup-inline",4,"ngIf"],["emptyMessage","Sin ordenes en proceso",3,"value","rows","paginator"],["pTemplate","list"],[1,"formgroup-inline"],[1,"field","col-12","md:col-12","lg:col-9"],["placeholder","Buscar alimento(s) o bebida(s)","optionLabel","name",3,"ngModelChange","onFocus","completeMethod","onSelect","inputStyle","ngModel","suggestions","dropdown"],["pTemplate","item"],[1,"field","col-12","md:col-12","lg:col-2"],["placeholder","Cantidad","buttonLayout","horizontal","spinnerMode","horizontal","incrementButtonIcon","pi pi-plus","decrementButtonIcon","pi pi-minus",3,"ngModelChange","inputStyle","ngModel","showButtons","step","min","max"],[1,"grid"],[1,"col"],[1,"col-fixed"],["rows","1","cols","30","pInputTextarea","","placeholder","Complementos u/o Observaci\xF3n",3,"ngModelChange","autoResize","ngModel"],["pButton","","pRipple","","icon","pi pi-plus","label","Agregar",3,"click"],["class","field col-12 md:col-12 lg:col-4",4,"ngIf"],[1,"field","col-12","md:col-12","lg:col-4"],["label","Asistencia","icon","pi pi-bell","severity","info",3,"click","raised","ngClass"],[1,"field","col-12","md:col-12","lg:col-3"],["label","Cuenta","icon","pi pi-check",3,"click","raised","ngClass"],["label","Menu","icon","pi pi-list",3,"raised"],[1,"grid","grid-nogutter"],["class","col-12 pb-2",4,"ngFor","ngForOf"],[1,"col-12","border-top-1","surface-border","pt-2"],[1,"text-lg","font-medium","text-900","mt-1"],["severity","success","size","small",3,"onClick",4,"ngIf"],[1,"col-12","pb-2"],[1,"grid",3,"ngClass"],["alt","dropdown icon","src","/assets/images/icon/ban.svg","style","width: 25px;",4,"ngIf"],["alt","dropdown icon","src","./assets/images/icon/process.svg","style","width: 25px;",4,"ngIf"],["alt","dropdown icon","src","./assets/images/icon/uniform.svg","style","width: 25px;",4,"ngIf"],["alt","dropdown icon","src","./assets/images/icon/delivery.svg","style","width: 25px;",4,"ngIf"],["alt","dropdown icon","src","./assets/images/icon/meal.svg","style","width: 25px;",4,"ngIf"],[1,"text-900","mt-1"],[1,"col-fixed","gap-1"],["class","col-fixed gap-1",4,"ngIf"],["alt","dropdown icon","src","/assets/images/icon/ban.svg",2,"width","25px"],["alt","dropdown icon","src","./assets/images/icon/process.svg",2,"width","25px"],["alt","dropdown icon","src","./assets/images/icon/uniform.svg",2,"width","25px"],["alt","dropdown icon","src","./assets/images/icon/delivery.svg",2,"width","25px"],["alt","dropdown icon","src","./assets/images/icon/meal.svg",2,"width","25px"],["icon","pi pi-check","severity","success","size","small",3,"onClick","disabled"],["icon","pi pi-ban","severity","danger","size","small",3,"onClick","disabled"],["severity","success","size","small",3,"onClick"],[1,"flex","flex-column","align-items-center","p-5","surface-overlay","border-round"],[1,"border-circle","bg-primary","inline-flex","justify-content-center","align-items-center","h-6rem","w-6rem"],[1,"pi","pi-question","text-5xl"],[1,"font-bold","text-2xl","block","mb-2","mt-4"],[1,"mb-0"],[1,"flex","align-items-center","gap-2","mt-4"],["pButton","","label","Si",1,"w-8rem",3,"click"],["pButton","","label","No",1,"p-button-outlined","w-8rem",3,"click"]],template:function(n,i){if(n&1){let l=w();h(0,ke,6,0,"div",2)(1,He,9,15,"div",3),v(2,"p-toast"),o(3,"p-confirmDialog",null,0),h(5,Ue,10,2,"ng-template",4),s(),o(6,"p-dialog",5),S("visibleChange",function(_){return m(l),M(i.showModalDiner,_)||(i.showModalDiner=_),p(_)}),o(7,"div",6)(8,"div",7)(9,"label",8),u(10,"Nombre del cliente"),s(),o(11,"input",9),S("ngModelChange",function(_){return m(l),M(i.diner.name_client,_)||(i.diner.name_client=_),p(_)}),s()(),o(12,"div",7)(13,"label",10),u(14,"Telefono del cliente"),s(),o(15,"p-inputMask",11),S("ngModelChange",function(_){return m(l),M(i.diner.phone_number,_)||(i.diner.phone_number=_),p(_)}),s()()(),o(16,"div",12),v(17,"p-button",13),o(18,"p-button",14),f("click",function(){return m(l),p(i.saveDiner())}),s()()()}n&2&&(a("ngIf",i.skeleton),r(),a("ngIf",!i.skeleton),r(5),a("modal",!0),I("visible",i.showModalDiner),r(5),I("ngModel",i.diner.name_client),r(4),x(y(9,C)),I("ngModel",i.diner.phone_number),r(2),a("routerLink","/kitchen/tables"))},dependencies:[Z,W,N,P,oe,se,K,le,G,H,U,ae,ce,pe,_e,de,me,ge,ue,he,ve,z],styles:[".item-cancel[_ngcontent-%COMP%]{background-color:var(--highlight-bg)!important;color:var(--surface-c)!important;text-decoration:line-through;text-decoration-color:#000!important}"]})}}return t})();var xe=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=k({type:t})}static{this.\u0275inj=T({imports:[F.forChild([{path:"",component:Ce}]),F]})}}return t})();var yt=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=k({type:t})}static{this.\u0275inj=T({imports:[xe,fe]})}}return t})();export{yt as AttendaceModule};
