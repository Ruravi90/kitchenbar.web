<div class="grid">
    <div class="col-12">
        <p-card header="Instancias" [style]="{'width':'100%'}">
            <!-- Used Table instead of DataView for better columnar data -->
            <p-table [value]="items" [tableStyle]="{'min-width': '60rem'}">
                <ng-template pTemplate="header">
                    <tr>
                        <th>Cliente</th>
                        <th>Cocina</th>
                        <th>Plan Actual</th>
                        <th>Vencimiento</th>
                        <th>Acciones</th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-item>
                    <tr>
                        <td>{{ item.name_client }}</td>
                        <td>{{ item.name_kitchen }}</td>
                        <td>{{ item.license?.name || 'Sin Plan' }}</td>
                        <td>
                            <span [ngClass]="{'text-red-500 font-bold': !getActiveExpiration(item)}">
                                {{ getActiveExpiration(item) ? (getActiveExpiration(item) | date) : 'Expirado' }}
                            </span>
                        </td>
                        <td>
                            <p-button icon="pi pi-pencil" [rounded]="true" [outlined]="true" severity="warning" size="small" pTooltip="Editar" class="mr-2"/>
                            <p-button icon="pi pi-refresh" [rounded]="true" [outlined]="true" severity="success" size="small" pTooltip="Renovar Suscripción" label="Renovar" class="mr-2" (click)="openRenew(item)"/>
                            <p-button icon="pi pi-trash" [rounded]="true" [outlined]="true" severity="danger" size="small" pTooltip="Eliminar"/>
                        </td>
                    </tr>
                </ng-template>
            </p-table>
        </p-card>
    </div>
</div>

<p-dialog [(visible)]="renewDialog" [style]="{width: '450px'}" header="Renovar Suscripción" [modal]="true" styleClass="p-fluid">
    <ng-template pTemplate="content">
        <div class="field">
            <label for="instance">Instancia</label>
            <input type="text" pInputText [value]="selectedInstance?.name_client" disabled />
        </div>
        <div class="field">
            <label for="license">Plan (Licencia)</label>
            <p-dropdown [options]="licenses" [(ngModel)]="selectedLicense" optionLabel="name" placeholder="Selecciona un Plan"></p-dropdown>
            <small class="p-error" *ngIf="submitted && !selectedLicense">El plan es requerido.</small>
        </div>
        <div class="field">
            <label for="rangeDates">Periodo de Vigencia</label>
            <p-calendar [(ngModel)]="rangeDates" selectionMode="range" [readonlyInput]="true" placeholder="Selecciona Rango de Fechas" appendTo="body"></p-calendar>
             <small class="p-error" *ngIf="submitted && (!rangeDates || rangeDates.length < 2)">El rango de fechas es requerido.</small>
        </div>
    </ng-template>

    <ng-template pTemplate="footer">
        <button pButton pRipple label="Cancelar" icon="pi pi-times" class="p-button-text" (click)="hideDialog()"></button>
        <button pButton pRipple label="Confirmar Renovación" icon="pi pi-check" class="p-button-text" (click)="saveRenewal()"></button>
    </ng-template>
</p-dialog>
