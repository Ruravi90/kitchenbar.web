<div class="history-container">
    <app-client-navigation></app-client-navigation>
    <h2>Order History</h2>

    <div class="orders-list">
        <ng-container *ngIf="orders$ | async as orders; else loading">
            <div class="empty-state" *ngIf="orders.length === 0">
                <p>No orders yet. Start ordering your favorite meals!</p>
            </div>

            <div class="order-card" *ngFor="let order of orders">
                <div class="order-header">
                    <span class="order-date">{{ order.createdAt | date:'mediumDate' }}</span>
                    <span class="order-status-badge" [ngClass]="getStatusClass(order.statusOrderId, order.isCancel)">
                        {{ getStatusLabel(order.statusOrderId, order.isCancel) }}
                    </span>
                </div>
                
                <div class="order-body">
                    <div class="branch-info" *ngIf="order.branch">
                        <strong>{{ order.branch.name }}</strong>
                    </div>
                    
                    <div class="items-summary" *ngIf="order.meal">
                         <p class="meal-name">{{ order.meal.name }}</p>
                         <div class="meal-details">
                            <span class="quantity">Cantidad: {{ order.quantity }}</span>
                            <span class="separator">â€¢</span>
                            <span class="price">{{ order.meal.price | currency }} c/u</span>
                         </div>
                    </div>
                </div>

                <div class="order-footer">
                    <span class="total-label">Total:</span>
                    <span class="total-amount">{{ getOrderTotal(order) | currency }}</span>
                </div>
                
                <!-- Cancel button for pending orders only -->
                <div class="order-actions" *ngIf="canCancelOrder(order)">
                    <button pButton label="Cancelar Pedido" 
                            icon="pi pi-times" 
                            class="p-button-danger p-button-sm w-full mt-2"
                            (click)="cancelOrder(order)">
                    </button>
                </div>
            </div>
        </ng-container>

        <ng-template #loading>
            <div class="loading-spinner">Loading history...</div>
        </ng-template>
    </div>
</div>

<p-confirmDialog></p-confirmDialog>
<p-toast></p-toast>
