import{b as me,c as pe,d as ue,g as _e,h as ge,i as he,k as fe}from"./chunk-IFFKKBZV.js";import"./chunk-BQVHG75P.js";import{a as oe,l as ce,n as de}from"./chunk-OSNXDCNO.js";import"./chunk-QFKRZ7EC.js";import{b as ae,c as se}from"./chunk-GQ2UZOTQ.js";import{b as G,d as H,g as U,j as $,l as ee,m as te,n as ie,p as ne,q as re,t as le}from"./chunk-5C42LTVV.js";import"./chunk-4YRY4IP2.js";import{e as X,g as J,l as K}from"./chunk-IDCO3KAE.js";import{$a as N,Aa as M,Ba as S,C as m,D as p,Ea as g,Fa as F,Ga as R,Ka as V,La as O,P as r,Q as h,Y as b,_ as l,_a as W,ab as P,ba as C,da as a,db as z,ea as s,fa as x,g as E,ja as w,ka as f,la as c,qa as j,qb as Q,sb as Y,t as T,tb as Z,va as q,vb as L,wa as _,x as B,xa as A,y as k,ya as D,za as I}from"./chunk-LVDDLAXI.js";var v=()=>({width:"100%"}),ve=i=>({"button-flash":i}),Se=(i,d)=>({"border-top-1 surface-border":i,"item-cancel":d});function Ae(i,d){if(i&1&&(a(0,"div",25)(1,"div",26),_(2),s(),a(3,"div",27),_(4),V(5,"currency"),s()()),i&2){let e=d.$implicit;r(2),A(e.name),r(2),A(O(5,2,e.price))}}function Te(i,d){if(i&1){let e=w();a(0,"div",19)(1,"div",20)(2,"p-autoComplete",21),S("ngModelChange",function(t){m(e);let o=c();return M(o.selectedItem,t)||(o.selectedItem=t),p(t)}),f("onFocus",function(t){m(e);let o=c();return p(o.focusSearchMeal(t))})("completeMethod",function(t){m(e);let o=c();return p(o.searchMeal(t))})("onSelect",function(t){m(e);let o=c();return p(o.completeSelectMeal(t))}),b(3,Ae,6,4,"ng-template",22),s()(),a(4,"div",23)(5,"p-inputNumber",24),S("ngModelChange",function(t){m(e);let o=c();return M(o.order.quantity,t)||(o.order.quantity=t),p(t)}),s()()()}if(i&2){let e=c();r(2),C(g(14,v)),l("inputStyle",g(15,v)),I("ngModel",e.selectedItem),l("suggestions",e.suggestionsMeal)("dropdown",!0),r(3),C(g(16,v)),l("inputStyle",g(17,v)),I("ngModel",e.order.quantity),l("showButtons",!0)("step",1)("min",1)("max",100)}}function ke(i,d){if(i&1){let e=w();a(0,"div",19)(1,"div",20)(2,"textarea",28),S("ngModelChange",function(t){m(e);let o=c();return M(o.order.aditional,t)||(o.order.aditional=t),p(t)}),_(3,"                    "),s()(),a(4,"div",23)(5,"button",29),f("click",function(){m(e);let t=c();return p(t.addOrder())}),s()()()}if(i&2){let e=c();r(2),C(g(6,v)),l("autoResize",!0),I("ngModel",e.order.aditional),r(3),C(g(7,v))}}function Ve(i,d){i&1&&(a(0,"div",31),x(1,"p-button",35),s()),i&2&&(r(),C(g(3,v)),l("raised",!0))}function Oe(i,d){if(i&1){let e=w();a(0,"div",19),b(1,Ve,2,4,"div",30),a(2,"div",31)(3,"p-button",32),f("click",function(){m(e);let t=c();return p(t.requestAttendace())}),s()(),a(4,"div",33)(5,"p-button",34),f("click",function(){m(e);let t=c();return p(t.requestCheck())}),s()()()}if(i&2){let e=c();r(),l("ngIf",!1),r(2),C(g(9,v)),l("raised",!0)("ngClass",F(10,ve,e.table==null?null:e.table.isRequestAttendace)),r(2),C(g(12,v)),l("raised",!0)("ngClass",F(13,ve,e.table==null?null:e.table.isRequestCheck))}}function Ee(i,d){i&1&&x(0,"img",51)}function qe(i,d){i&1&&x(0,"img",52)}function De(i,d){i&1&&x(0,"img",53)}function Fe(i,d){i&1&&x(0,"img",54)}function Le(i,d){i&1&&x(0,"img",55)}function Be(i,d){if(i&1){let e=w();a(0,"div",49)(1,"p-button",56),f("onClick",function(t){m(e);let o=c().$implicit,y=c(2);return p(y.changeStatusOrder(t,o))}),s()()}if(i&2){let e=c().$implicit;r(),l("disabled",e.statusOrderId!=3)}}function je(i,d){if(i&1){let e=w();a(0,"div",49)(1,"p-button",57),f("onClick",function(){m(e);let t=c().$implicit,o=c(2);return p(o.confirmCancel(t))}),s()()}if(i&2){let e=c().$implicit;r(),l("disabled",e.isCancel||e.statusOrderId>=3)}}function Re(i,d){if(i&1&&(a(0,"div",41)(1,"div",42)(2,"div",27),b(3,Ee,1,0,"img",43)(4,qe,1,0,"img",44)(5,De,1,0,"img",45)(6,Fe,1,0,"img",46)(7,Le,1,0,"img",47),s(),a(8,"div",26)(9,"div",48),_(10),s()(),a(11,"div",49)(12,"div",48),_(13),V(14,"currency"),s()(),b(15,Be,2,1,"div",50)(16,je,2,1,"div",50),s()()),i&2){let e=d.$implicit,n=d.first,t=c(2);r(),l("ngClass",R(12,Se,!n,e.isCancel)),r(2),l("ngIf",e.isCancel),r(),l("ngIf",e.statusOrderId==1&&!e.isCancel),r(),l("ngIf",e.statusOrderId==2&&!e.isCancel),r(),l("ngIf",e.statusOrderId==3&&!e.isCancel),r(),l("ngIf",e.statusOrderId==4&&!e.isCancel),r(3),A(e.quantity+" "+(e.meal==null?null:e.meal.name)),r(3),A(O(14,10,(e.meal==null?null:e.meal.price)*e.quantity)),r(2),l("ngIf",t.isLogin),r(),l("ngIf",t.isLogin)}}function We(i,d){if(i&1){let e=w();a(0,"p-button",58),f("onClick",function(){m(e);let t=c(2);return p(t.confirmCloseTicket())}),_(1,"Cerrar cuenta"),s()}}function Ne(i,d){if(i&1&&(a(0,"div",36),b(1,Re,17,15,"div",37),a(2,"div",38)(3,"div",25)(4,"div",26)(5,"div",39),_(6),V(7,"currency"),s()(),a(8,"div",27),b(9,We,2,0,"p-button",40),s()()()()),i&2){let e=d.$implicit,n=c();r(),l("ngForOf",e),r(5),D("Total: ",O(7,3,n.totalOrder)," MXN"),r(3),l("ngIf",n.isLogin)}}function Pe(i,d){if(i&1){let e=w();a(0,"div",59)(1,"div",60),x(2,"i",61),s(),a(3,"span",62),_(4),s(),a(5,"p",63),_(6),s(),a(7,"div",64)(8,"button",65),f("click",function(){m(e),c();let t=q(11);return p(t.accept())}),s(),a(9,"button",66),f("click",function(){m(e),c();let t=q(11);return p(t.reject())}),s()()()}if(i&2){let e=d.$implicit;r(4),D(" ",e.header," "),r(2),A(e.message)}}var be=(()=>{class i{constructor(e,n,t,o,y,u,xe,we,Ie,Me){this.confirmationService=e,this.messageService=n,this._serviceAuth=t,this._serviceTable=o,this._serviceOrder=y,this._serviceDiner=u,this._serviceMeal=xe,this.route=we,this.router=Ie,this.hub=Me,this.items=[],this.order={},this.isLogin=!1,this.totalOrder=0,this.isRequestAttendace=!1,this.isRequestCheck=!1,this.diner={name_client:"Cliente an\xF3nimo"},this.suggestionsMeal=[],this.meals=[],this.tableIdentity="",this.instanceIdentity="",this.showModalDiner=!1,this.isLogin=t.checkLogin()}ngOnInit(){return E(this,null,function*(){this.order.quantity=1,this.order.statusOrderId=1,yield this.delay(1e3),this.tableIdentity=this.route.snapshot.paramMap.get("identity"),this.isLogin||(this.hub.connect(),yield this.delay(1e3),this.hub.newUser().subscribe()),yield this.delay(1e3),this.getTable(),this.getDiner(),yield this.delay(1e3),this.getOrders(),this.isLogin&&this.getMeals(),this.hub.receiveOrderFromTable().subscribe(e=>{"number".includes(typeof this.diner.id)||(this.getDiner(),this.delay(1e3)),this.getOrders()})})}ngOnDestroy(){}delay(e){return E(this,null,function*(){return new Promise(n=>setTimeout(n,e))})}getTable(){this._serviceTable.getByIdentity(this.tableIdentity).subscribe({next:e=>{console.log(e),this.table=e,this.instanceIdentity=e.instance.identity,this.isLogin||this.hub.joinGroupAnonymus(e.instance.identity)},error:e=>{this.messageService.add({severity:"warn",summary:"Alerta",detail:e.error.messages})}})}getOrders(){this.totalOrder=0,this._serviceOrder.getItemsByTable(this.diner.id).subscribe({next:e=>{this.items=e,this.items.forEach(n=>{n.isCancel||(this.totalOrder+=n.meal.price*n.quantity)})},error:e=>{this.messageService.add({severity:"warn",summary:"Alerta",detail:e.error.messages})}})}getDiner(){this._serviceDiner.getItemsByTable(this.tableIdentity).subscribe({next:e=>{e==null&&this.isLogin?this.showModalDiner=!0:this.diner=e},error:e=>{this.messageService.add({severity:"warn",summary:"Alerta",detail:e.error.messages})}})}getMeals(){this._serviceMeal.getByInstanceIdentity(this.table?.instance?.identity).subscribe({next:e=>{this.meals=e},error:e=>{this.messageService.add({severity:"warn",summary:"Alerta",detail:e.error.messages})}})}requestAttendace(){this.table.isRequestCheck=!1,this.table.isRequestAttendace=!this.table.isRequestAttendace,this._serviceTable.request(this.table).subscribe({next:()=>{this.hub.sendNotificationTables(this.table)},error:e=>{this.messageService.add({severity:"warn",summary:"Alerta",detail:e.error.messages})}})}requestCheck(){this.table.isRequestCheck=!this.table.isRequestCheck,this.table.isRequestAttendace=!1,this._serviceTable.request(this.table).subscribe({next:()=>{this.hub.sendNotificationTables(this.table)},error:e=>{this.messageService.add({severity:"warn",summary:"Alerta",detail:e.error.messages})}})}focusSearchMeal(e){}searchMeal(e){let n=[],t=e.query;for(let o=0;o<this.meals.length;o++){let y=this.meals[o];y.name.toLowerCase().indexOf(t.toLowerCase())==0&&n.push(y)}this.suggestionsMeal=n}completeSelectMeal(e){this.order={mealId:e.value.id,tableId:this.table?.id,statusOrderId:1,quantity:1}}addOrder(){this.selectedItem&&(this.order.dinerId=this.diner.id,this._serviceOrder.createItem(this.order).subscribe({next:e=>{this.hub.sendOrder(this.order),this.order={},this.order.dinerId=this.diner.id,this.order.quantity=1,this.selectedItem=void 0},error:e=>{this.messageService.add({severity:"warn",summary:"Alerta",detail:e.error.messages})}}))}cancelOrder(e){e.isCancel=!0,this._serviceOrder.updateItem(e.id,e).subscribe({next:n=>{this.hub.sendOrder(e)},error:n=>{this.messageService.add({severity:"warn",summary:"Alerta",detail:n.error.messages})}})}confirmCancel(e){this.confirmationService.confirm({header:"Estas seguro de cancelar?",message:"Por favor de confirmar.",accept:()=>{this.cancelOrder(e)}})}changeStatusOrder(e,n){this.confirmationService.confirm({target:e.target,message:"",header:"Se entrego el alimento?",accept:()=>{n.statusOrderId=4,this._serviceOrder.updateItem(n.id,n).subscribe({next:t=>{this.hub.sendOrder(n)},error:t=>{this.messageService.add({severity:"warn",summary:"Alerta",detail:t.error.messages})}})}})}confirmCloseTicket(){this.confirmationService.confirm({header:"Estas seguro de cerrar la cuenta?",message:"Por favor de confirmar.",accept:()=>{this._serviceDiner.closeTicket(this.diner.id).subscribe({next:e=>{this.router.navigate(["/kitchen/tables"])},error:e=>{this.messageService.add({severity:"warn",summary:"Alerta",detail:e.error.messages}),this.showModalDiner=!0}})}})}saveDiner(){this.table!=null&&(this.diner.tableId=this.table.id,this._serviceDiner.createItem(this.diner).subscribe({next:e=>{this.showModalDiner=!1},error:e=>{this.showModalDiner=!0,this.messageService.add({severity:"warn",summary:"Alerta",detail:e.error.messages})}}))}static{this.\u0275fac=function(n){return new(n||i)(h(X),h(J),h($),h(ie),h(te),h(re),h(ee),h(Q),h(Y),h(ne))}}static{this.\u0275cmp=B({type:i,selectors:[["app-attendace"]],decls:26,vars:20,consts:[["dv",""],["cd",""],[1,"flex","flex-wrap","justify-content-center"],[1,"w-full"],[3,"header"],["class","formgroup-inline",4,"ngIf"],["emptyMessage","Sin ordenes en proceso",3,"value","rows","paginator"],["pTemplate","list"],["pTemplate","headless"],["header","Cliente","closable","false",3,"visibleChange","modal","visible"],[1,"formgrid","grid","gap-3","mb-3","mt-3"],[1,"field","col-12"],["for","name"],["pInputText","","id","name","type","text",1,"w-full",3,"ngModelChange","ngModel"],["for","phone"],["id","phone","mask","99-9999-9999","placeholder","99-9999-9999",3,"ngModelChange","ngModel"],[1,"flex","justify-content-end","gap-2"],["label","Cancelar","severity","secondary",3,"routerLink"],["label","Guardar",3,"click"],[1,"formgroup-inline"],[1,"field","col-12","md:col-12","lg:col-9"],["placeholder","Buscar alimento(s) o bebida(s)","optionLabel","name",3,"ngModelChange","onFocus","completeMethod","onSelect","inputStyle","ngModel","suggestions","dropdown"],["pTemplate","item"],[1,"field","col-12","md:col-12","lg:col-2"],["placeholder","Cantidad","buttonLayout","horizontal","spinnerMode","horizontal","incrementButtonIcon","pi pi-plus","decrementButtonIcon","pi pi-minus",3,"ngModelChange","inputStyle","ngModel","showButtons","step","min","max"],[1,"grid"],[1,"col"],[1,"col-fixed"],["rows","1","cols","30","pInputTextarea","","placeholder","Complementos u/o Observaci\xF3n",3,"ngModelChange","autoResize","ngModel"],["pButton","","pRipple","","icon","pi pi-plus","label","Agregar",3,"click"],["class","field col-12 md:col-12 lg:col-4",4,"ngIf"],[1,"field","col-12","md:col-12","lg:col-4"],["label","Asistencia","icon","pi pi-bell","severity","info",3,"click","raised","ngClass"],[1,"field","col-12","md:col-12","lg:col-3"],["label","Cuenta","icon","pi pi-check",3,"click","raised","ngClass"],["label","Menu","icon","pi pi-list",3,"raised"],[1,"grid","grid-nogutter"],["class","col-12 pb-2",4,"ngFor","ngForOf"],[1,"col-12","border-top-1","surface-border","pt-2"],[1,"text-lg","font-medium","text-900","mt-1"],["severity","success","size","small",3,"onClick",4,"ngIf"],[1,"col-12","pb-2"],[1,"grid",3,"ngClass"],["alt","dropdown icon","src","/assets/images/icon/ban.svg","style","width: 25px;",4,"ngIf"],["alt","dropdown icon","src","./assets/images/icon/process.svg","style","width: 25px;",4,"ngIf"],["alt","dropdown icon","src","./assets/images/icon/uniform.svg","style","width: 25px;",4,"ngIf"],["alt","dropdown icon","src","./assets/images/icon/delivery.svg","style","width: 25px;",4,"ngIf"],["alt","dropdown icon","src","./assets/images/icon/meal.svg","style","width: 25px;",4,"ngIf"],[1,"text-900","mt-1"],[1,"col-fixed","gap-1"],["class","col-fixed gap-1",4,"ngIf"],["alt","dropdown icon","src","/assets/images/icon/ban.svg",2,"width","25px"],["alt","dropdown icon","src","./assets/images/icon/process.svg",2,"width","25px"],["alt","dropdown icon","src","./assets/images/icon/uniform.svg",2,"width","25px"],["alt","dropdown icon","src","./assets/images/icon/delivery.svg",2,"width","25px"],["alt","dropdown icon","src","./assets/images/icon/meal.svg",2,"width","25px"],["icon","pi pi-check","severity","success","size","small",3,"onClick","disabled"],["icon","pi pi-ban","severity","danger","size","small",3,"onClick","disabled"],["severity","success","size","small",3,"onClick"],[1,"flex","flex-column","align-items-center","p-5","surface-overlay","border-round"],[1,"border-circle","bg-primary","inline-flex","justify-content-center","align-items-center","h-6rem","w-6rem"],[1,"pi","pi-question","text-5xl"],[1,"font-bold","text-2xl","block","mb-2","mt-4"],[1,"mb-0"],[1,"flex","align-items-center","gap-2","mt-4"],["pButton","","label","Si",1,"w-8rem",3,"click"],["pButton","","label","No",1,"p-button-outlined","w-8rem",3,"click"]],template:function(n,t){if(n&1){let o=w();a(0,"div",2)(1,"div",3)(2,"p-card",4),b(3,Te,6,18,"div",5)(4,ke,6,8,"div",5)(5,Oe,6,15,"div",5),a(6,"p-dataView",6,0),b(8,Ne,10,5,"ng-template",7),s()()()(),x(9,"p-toast"),a(10,"p-confirmDialog",null,1),b(12,Pe,10,2,"ng-template",8),s(),a(13,"p-dialog",9),S("visibleChange",function(u){return m(o),M(t.showModalDiner,u)||(t.showModalDiner=u),p(u)}),a(14,"div",10)(15,"div",11)(16,"label",12),_(17,"Nombre del cliente"),s(),a(18,"input",13),S("ngModelChange",function(u){return m(o),M(t.diner.name_client,u)||(t.diner.name_client=u),p(u)}),s()(),a(19,"div",11)(20,"label",14),_(21,"Telefono del cliente"),s(),a(22,"p-inputMask",15),S("ngModelChange",function(u){return m(o),M(t.diner.phone_number,u)||(t.diner.phone_number=u),p(u)}),s()()(),a(23,"div",16),x(24,"p-button",17),a(25,"p-button",18),f("click",function(){return m(o),p(t.saveDiner())}),s()()()}n&2&&(r(2),C(g(18,v)),j("header","Mesa ",t.table==null?null:t.table.name," a nombre de ",t.diner.name_client,""),r(),l("ngIf",t.isLogin),r(),l("ngIf",t.isLogin),r(),l("ngIf",!t.isLogin),r(),l("value",t.items)("rows",10)("paginator",!0),r(7),l("modal",!0),I("visible",t.showModalDiner),r(5),I("ngModel",t.diner.name_client),r(4),C(g(19,v)),I("ngModel",t.diner.phone_number),r(2),l("routerLink","/kitchen/tables"))},dependencies:[Z,W,N,P,ae,se,K,le,G,H,U,oe,ce,pe,ue,de,me,ge,_e,he,z],styles:[".item-cancel[_ngcontent-%COMP%]{background-color:var(--highlight-bg)!important;color:var(--surface-c)!important;text-decoration:line-through;text-decoration-color:#000!important}"]})}}return i})();var Ce=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=k({type:i})}static{this.\u0275inj=T({imports:[L.forChild([{path:"",component:be}]),L]})}}return i})();var _t=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=k({type:i})}static{this.\u0275inj=T({imports:[Ce,fe]})}}return i})();export{_t as AttendaceModule};
