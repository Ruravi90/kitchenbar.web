<div class="link-branch-container">
  <div class="header">
    <h2>Agregar Restaurante a Favoritos</h2>
    <p>Escanea el código QR del restaurante</p>
  </div>

  <!-- QR Scanner -->
  <div *ngIf="isScanning" class="scanner-wrapper">
    <app-qr-scanner
      (scanSuccess)="onScanSuccess($event)"
      (scanError)="onScanError($event)">
    </app-qr-scanner>
  </div>

  <!-- Loading State -->
  <div *ngIf="isProcessing && !showConfirmation" class="loading-state">
    <p-progressSpinner></p-progressSpinner>
    <p>Cargando información...</p>
  </div>

  <!-- Branch Preview Dialog -->
  <p-dialog 
    [(visible)]="showConfirmation" 
    [modal]="true"
    [style]="{width: '90vw', maxWidth: '500px'}"
    [dismissableMask]="true"
    [closable]="true"
    (onHide)="cancelAndRescan()">
    
    <ng-template pTemplate="header">
      <div class="dialog-header">
        <i class="pi pi-building"></i>
        <h3>{{ branchData?.name }}</h3>
      </div>
    </ng-template>
    
    <div class="branch-preview" *ngIf="branchData">
      <div class="preview-logo" *ngIf="branchData.logoUrl">
        <img [src]="branchData.logoUrl" [alt]="branchData.name">
      </div>
      
      <div class="preview-details">
        <div class="detail-item" *ngIf="branchData.instanceName">
          <i class="pi pi-tag"></i>
          <span>{{ branchData.instanceName }}</span>
        </div>
        
        <div class="detail-item" *ngIf="branchData.address">
          <i class="pi pi-map-marker"></i>
          <span>{{ branchData.address }}</span>
        </div>
        
        <div class="detail-item" *ngIf="branchData.phoneNumber">
          <i class="pi pi-phone"></i>
          <span>{{ branchData.phoneNumber }}</span>
        </div>
      </div>
    </div>
    
    <ng-template pTemplate="footer">
      <button 
        pButton 
        label="Agregar a Favoritos" 
        icon="pi pi-heart"
        class="p-button-success"
        (click)="confirmAddFavorite()"
        [loading]="isProcessing"></button>
      <button 
        pButton 
        label="Ver Menú" 
        icon="pi pi-book"
        class="p-button-outlined"
        (click)="goToMenu()"></button>
    </ng-template>
  </p-dialog>
</div>

<p-toast></p-toast>
