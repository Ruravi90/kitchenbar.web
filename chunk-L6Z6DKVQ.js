import{b as de,c as pe,d as me,g as ue,h as _e,i as ge,j as he}from"./chunk-IXSFSNLD.js";import"./chunk-J6VSZILJ.js";import{a as ae,l as le,n as ce}from"./chunk-65D7KFAQ.js";import"./chunk-ETYH724P.js";import{b as re,c as oe}from"./chunk-BJ7UQRZ4.js";import{b as G,d as H,g as U,j as Z,l as $,m as ee,n as te,p as ie,q as ne,t as se}from"./chunk-MLSKFZ7F.js";import"./chunk-4YRY4IP2.js";import{e as X,g as J,l as K}from"./chunk-JY4AAIVW.js";import{$ as y,A as p,B as m,Ca as g,Da as F,Ea as R,Ia as V,Ja as O,N as r,O as h,W as C,Y as l,Ya as W,Za as N,_a as P,ba as o,bb as z,ca as a,da as x,e as E,ha as w,ia as f,ja as c,nb as Q,oa as j,pb as Y,r as A,sb as B,ta as q,ua as _,v as L,va as T,w as k,wa as D,xa as I,ya as M,za as S}from"./chunk-VUSRYWWQ.js";var v=()=>({width:"100%"}),fe=i=>({"button-flash":i}),Me=(i,d)=>({"border-top-1 surface-border":i,"item-cancel":d});function Se(i,d){if(i&1&&(o(0,"div",2)(1,"div",24),_(2),a(),o(3,"div",25),_(4),V(5,"currency"),a()()),i&2){let e=d.$implicit;r(2),T(e.name),r(2),T(O(5,2,e.price))}}function Te(i,d){if(i&1){let e=w();o(0,"div",18)(1,"div",19)(2,"p-autoComplete",20),S("ngModelChange",function(t){p(e);let s=c();return M(s.selectedItem,t)||(s.selectedItem=t),m(t)}),f("onFocus",function(t){p(e);let s=c();return m(s.focusSearchMeal(t))})("completeMethod",function(t){p(e);let s=c();return m(s.searchMeal(t))})("onSelect",function(t){p(e);let s=c();return m(s.completeSelectMeal(t))}),C(3,Se,6,4,"ng-template",21),a()(),o(4,"div",22)(5,"p-inputNumber",23),S("ngModelChange",function(t){p(e);let s=c();return M(s.order.quantity,t)||(s.order.quantity=t),m(t)}),a()()()}if(i&2){let e=c();r(2),y(g(14,v)),l("inputStyle",g(15,v)),I("ngModel",e.selectedItem),l("suggestions",e.suggestionsMeal)("dropdown",!0),r(3),y(g(16,v)),l("inputStyle",g(17,v)),I("ngModel",e.order.quantity),l("showButtons",!0)("step",1)("min",1)("max",100)}}function Ae(i,d){if(i&1){let e=w();o(0,"div",18)(1,"div",19)(2,"textarea",26),S("ngModelChange",function(t){p(e);let s=c();return M(s.order.aditional,t)||(s.order.aditional=t),m(t)}),_(3,"                    "),a()(),o(4,"div",22)(5,"button",27),f("click",function(){p(e);let t=c();return m(t.addOrder())}),a()()()}if(i&2){let e=c();r(2),y(g(6,v)),l("autoResize",!0),I("ngModel",e.order.aditional),r(3),y(g(7,v))}}function ke(i,d){i&1&&(o(0,"div",29),x(1,"p-button",33),a()),i&2&&(r(),y(g(3,v)),l("raised",!0))}function Ve(i,d){if(i&1){let e=w();o(0,"div",18),C(1,ke,2,4,"div",28),o(2,"div",29)(3,"p-button",30),f("click",function(){p(e);let t=c();return m(t.requestAttendace())}),a()(),o(4,"div",31)(5,"p-button",32),f("click",function(){p(e);let t=c();return m(t.requestCheck())}),a()()()}if(i&2){let e=c();r(),l("ngIf",!1),r(2),y(g(9,v)),l("raised",!0)("ngClass",F(10,fe,e.table==null?null:e.table.isRequestAttendace)),r(2),y(g(12,v)),l("raised",!0)("ngClass",F(13,fe,e.table==null?null:e.table.isRequestCheck))}}function Oe(i,d){i&1&&x(0,"img",49)}function Ee(i,d){i&1&&x(0,"img",50)}function qe(i,d){i&1&&x(0,"img",51)}function De(i,d){i&1&&x(0,"img",52)}function Fe(i,d){i&1&&x(0,"img",53)}function Be(i,d){if(i&1){let e=w();o(0,"div",47)(1,"p-button",54),f("onClick",function(t){p(e);let s=c().$implicit,b=c(2);return m(b.changeStatusOrder(t,s))}),a()()}if(i&2){let e=c().$implicit;r(),l("disabled",e.statusOrderId!=3)}}function Le(i,d){if(i&1){let e=w();o(0,"div",47)(1,"p-button",55),f("onClick",function(){p(e);let t=c().$implicit,s=c(2);return m(s.confirmCancel(t))}),a()()}if(i&2){let e=c().$implicit;r(),l("disabled",e.isCancel||e.statusOrderId>=3)}}function je(i,d){if(i&1&&(o(0,"div",39)(1,"div",40)(2,"div",25),C(3,Oe,1,0,"img",41)(4,Ee,1,0,"img",42)(5,qe,1,0,"img",43)(6,De,1,0,"img",44)(7,Fe,1,0,"img",45),a(),o(8,"div",24)(9,"div",46),_(10),a()(),o(11,"div",47)(12,"div",46),_(13),V(14,"currency"),a()(),C(15,Be,2,1,"div",48)(16,Le,2,1,"div",48),a()()),i&2){let e=d.$implicit,n=d.first,t=c(2);r(),l("ngClass",R(12,Me,!n,e.isCancel)),r(2),l("ngIf",e.isCancel),r(),l("ngIf",e.statusOrderId==1&&!e.isCancel),r(),l("ngIf",e.statusOrderId==2&&!e.isCancel),r(),l("ngIf",e.statusOrderId==3&&!e.isCancel),r(),l("ngIf",e.statusOrderId==4&&!e.isCancel),r(3),T(e.quantity+" "+(e.meal==null?null:e.meal.name)),r(3),T(O(14,10,(e.meal==null?null:e.meal.price)*e.quantity)),r(2),l("ngIf",t.isLogin),r(),l("ngIf",t.isLogin)}}function Re(i,d){if(i&1){let e=w();o(0,"p-button",56),f("onClick",function(){p(e);let t=c(2);return m(t.confirmCloseTicket())}),_(1,"Cerrar cuenta"),a()}}function We(i,d){if(i&1&&(o(0,"div",34),C(1,je,17,15,"div",35),o(2,"div",36)(3,"div",2)(4,"div",24)(5,"div",37),_(6),V(7,"currency"),a()(),o(8,"div",25),C(9,Re,2,0,"p-button",38),a()()()()),i&2){let e=d.$implicit,n=c();r(),l("ngForOf",e),r(5),D("Total: ",O(7,3,n.totalOrder)," MXN"),r(3),l("ngIf",n.isLogin)}}function Ne(i,d){if(i&1){let e=w();o(0,"div",57)(1,"div",58),x(2,"i",59),a(),o(3,"span",60),_(4),a(),o(5,"p",61),_(6),a(),o(7,"div",62)(8,"button",63),f("click",function(){p(e),c();let t=q(11);return m(t.accept())}),a(),o(9,"button",64),f("click",function(){p(e),c();let t=q(11);return m(t.reject())}),a()()()}if(i&2){let e=d.$implicit;r(4),D(" ",e.header," "),r(2),T(e.message)}}var be=(()=>{class i{constructor(e,n,t,s,b,u,ye,xe,we,Ie){this.confirmationService=e,this.messageService=n,this._serviceAuth=t,this._serviceTable=s,this._serviceOrder=b,this._serviceDiner=u,this._serviceMeal=ye,this.route=xe,this.router=we,this.hub=Ie,this.items=[],this.order={},this.isLogin=!1,this.totalOrder=0,this.isRequestAttendace=!1,this.isRequestCheck=!1,this.diner={name_client:"Cliente an\xF3nimo"},this.suggestionsMeal=[],this.meals=[],this.tableIdentity="",this.instanceIdentity="",this.showModalDiner=!1,this.isLogin=t.checkLogin()}ngOnInit(){return E(this,null,function*(){this.isLogin||(this.hub.connect(),yield this.delay(1e3),this.hub.newUser().subscribe()),this.order.quantity=1,this.order.statusOrderId=1,this.tableIdentity=this.route.snapshot.paramMap.get("identity"),this.getTable(),this.getOrders(),this.getDiner(),yield this.delay(1e3),this.isLogin&&this.getMeals(),this.hub.receiveOrderFromTable().subscribe(e=>{this.getOrders()})})}ngOnDestroy(){}delay(e){return E(this,null,function*(){return new Promise(n=>setTimeout(n,e))})}getTable(){this._serviceTable.getByIdentity(this.tableIdentity).subscribe({next:e=>{console.log(e),this.table=e,this.instanceIdentity=e.instance.identity,this.isLogin||this.hub.joinGroupAnonymus(e.instance.identity)},error:e=>console.error(e)})}getOrders(){this._serviceOrder.getItemsByTable(this.diner.id).subscribe({next:e=>{console.log(e),this.items=e,this.items.forEach(n=>{n.isCancel||(this.totalOrder+=n.meal.price*n.quantity)})},error:e=>console.error(e)})}getDiner(){this._serviceDiner.getItemsByTable(this.tableIdentity).subscribe({next:e=>{e==null?this.showModalDiner=!0:this.diner=e},error:e=>console.error(e)})}getMeals(){this._serviceMeal.getByInstanceIdentity(this.table?.instance?.identity).subscribe({next:e=>{console.log("suggestionsMeal",e),this.meals=e},error:e=>console.error(e)})}requestAttendace(){this.table.isRequestCheck=!1,this.table.isRequestAttendace=!this.table.isRequestAttendace,this._serviceTable.request(this.table).subscribe({next:()=>{this.hub.sendNotificationTables(this.table)},error:e=>console.error(e)})}requestCheck(){this.table.isRequestCheck=!this.table.isRequestCheck,this.table.isRequestAttendace=!1,this._serviceTable.request(this.table).subscribe({next:()=>{this.hub.sendNotificationTables(this.table)},error:e=>console.error(e)})}focusSearchMeal(e){}searchMeal(e){let n=[],t=e.query;for(let s=0;s<this.meals.length;s++){let b=this.meals[s];b.name.toLowerCase().indexOf(t.toLowerCase())==0&&n.push(b)}this.suggestionsMeal=n}completeSelectMeal(e){this.order={mealId:e.value.id,tableId:this.table?.id,statusOrderId:1,quantity:1}}addOrder(){this.selectedItem&&(this.order.dinerId=this.diner.id,this._serviceOrder.createItem(this.order).subscribe({next:e=>{this.hub.sendOrder(this.order),this.order={},this.order.dinerId=this.diner.id,this.order.quantity=1,this.selectedItem=void 0},error:e=>console.error(e)}))}cancelOrder(e){e.isCancel=!0,this._serviceOrder.updateItem(e.id,e).subscribe({next:n=>{this.hub.sendOrder(e)},error:n=>console.error(n)})}confirmCancel(e){this.confirmationService.confirm({header:"Estas seguro de cancelar?",message:"Por favor de confirmar.",accept:()=>{this.cancelOrder(e)}})}changeStatusOrder(e,n){this.confirmationService.confirm({target:e.target,message:"",header:"Se entrego el alimento?",accept:()=>{n.statusOrderId=4,this._serviceOrder.updateItem(n.id,n).subscribe({next:t=>{this.hub.sendOrder(n)},error:t=>console.error(t)})}})}confirmCloseTicket(){this.confirmationService.confirm({header:"Estas seguro de cerrar la cuenta?",message:"Por favor de confirmar.",accept:()=>{this._serviceDiner.closeTicket(this.diner.id).subscribe({next:e=>{this.router.navigate(["/kitchen/tables"])},error:e=>{this.showModalDiner=!0}})}})}saveDiner(){this.table!=null&&(this.diner.tableId=this.table.id,this._serviceDiner.createItem(this.diner).subscribe({next:e=>{this.showModalDiner=!1},error:e=>{this.showModalDiner=!0}}))}static{this.\u0275fac=function(n){return new(n||i)(h(X),h(J),h(Z),h(te),h(ee),h(ne),h($),h(Q),h(Y),h(ie))}}static{this.\u0275cmp=L({type:i,selectors:[["app-attendace"]],decls:25,vars:19,consts:[["dv",""],["cd",""],[1,"grid"],[1,"col-10","col-offset-1"],[3,"header"],["class","formgroup-inline",4,"ngIf"],["emptyMessage","Sin ordenes en proceso",3,"value","rows","paginator"],["pTemplate","list"],["pTemplate","headless"],["header","Cliente","closable","false",3,"visibleChange","modal","visible"],[1,"formgrid","grid","gap-3","mb-3","mt-3"],[1,"field","col-12"],["for","name"],["pInputText","","id","name","type","text",1,"w-full",3,"ngModelChange","ngModel"],["for","phone"],["id","phone","mask","99-9999-9999","placeholder","99-9999-9999",3,"ngModelChange","ngModel"],[1,"flex","justify-content-end","gap-2"],["label","Guardar",3,"click"],[1,"formgroup-inline"],[1,"field","col-12","md:col-12","lg:col-9"],["placeholder","Buscar alimento(s) o bebida(s)","optionLabel","name",3,"ngModelChange","onFocus","completeMethod","onSelect","inputStyle","ngModel","suggestions","dropdown"],["pTemplate","item"],[1,"field","col-12","md:col-12","lg:col-2"],["placeholder","Cantidad","buttonLayout","horizontal","spinnerMode","horizontal","incrementButtonIcon","pi pi-plus","decrementButtonIcon","pi pi-minus",3,"ngModelChange","inputStyle","ngModel","showButtons","step","min","max"],[1,"col"],[1,"col-fixed"],["rows","1","cols","30","pInputTextarea","","placeholder","Complementos u/o Observaci\xF3n",3,"ngModelChange","autoResize","ngModel"],["pButton","","pRipple","","icon","pi pi-plus","label","Agregar",3,"click"],["class","field col-12 md:col-12 lg:col-4",4,"ngIf"],[1,"field","col-12","md:col-12","lg:col-4"],["label","Asistencia","icon","pi pi-bell","severity","info",3,"click","raised","ngClass"],[1,"field","col-12","md:col-12","lg:col-3"],["label","Cuenta","icon","pi pi-check",3,"click","raised","ngClass"],["label","Menu","icon","pi pi-list",3,"raised"],[1,"grid","grid-nogutter"],["class","col-12 pb-2",4,"ngFor","ngForOf"],[1,"col-12","border-top-1","surface-border","pt-2"],[1,"text-lg","font-medium","text-900","mt-1"],["severity","success","size","small",3,"onClick",4,"ngIf"],[1,"col-12","pb-2"],[1,"grid",3,"ngClass"],["alt","dropdown icon","src","/assets/images/icon/ban.svg","style","width: 25px;",4,"ngIf"],["alt","dropdown icon","src","/assets/images/icon/process.svg","style","width: 25px;",4,"ngIf"],["alt","dropdown icon","src","/assets/images/icon/uniform.svg","style","width: 25px;",4,"ngIf"],["alt","dropdown icon","src","/assets/images/icon/delivery.svg","style","width: 25px;",4,"ngIf"],["alt","dropdown icon","src","/assets/images/icon/meal.svg","style","width: 25px;",4,"ngIf"],[1,"text-900","mt-1"],[1,"col-fixed","gap-1"],["class","col-fixed gap-1",4,"ngIf"],["alt","dropdown icon","src","/assets/images/icon/ban.svg",2,"width","25px"],["alt","dropdown icon","src","/assets/images/icon/process.svg",2,"width","25px"],["alt","dropdown icon","src","/assets/images/icon/uniform.svg",2,"width","25px"],["alt","dropdown icon","src","/assets/images/icon/delivery.svg",2,"width","25px"],["alt","dropdown icon","src","/assets/images/icon/meal.svg",2,"width","25px"],["icon","pi pi-check","severity","success","size","small",3,"onClick","disabled"],["icon","pi pi-ban","severity","danger","size","small",3,"onClick","disabled"],["severity","success","size","small",3,"onClick"],[1,"flex","flex-column","align-items-center","p-5","surface-overlay","border-round"],[1,"border-circle","bg-primary","inline-flex","justify-content-center","align-items-center","h-6rem","w-6rem"],[1,"pi","pi-question","text-5xl"],[1,"font-bold","text-2xl","block","mb-2","mt-4"],[1,"mb-0"],[1,"flex","align-items-center","gap-2","mt-4"],["pButton","","label","Si",1,"w-8rem",3,"click"],["pButton","","label","No",1,"p-button-outlined","w-8rem",3,"click"]],template:function(n,t){if(n&1){let s=w();o(0,"div",2)(1,"div",3)(2,"p-card",4),C(3,Te,6,18,"div",5)(4,Ae,6,8,"div",5)(5,Ve,6,15,"div",5),o(6,"p-dataView",6,0),C(8,We,10,5,"ng-template",7),a()()()(),x(9,"p-toast"),o(10,"p-confirmDialog",null,1),C(12,Ne,10,2,"ng-template",8),a(),o(13,"p-dialog",9),S("visibleChange",function(u){return p(s),M(t.showModalDiner,u)||(t.showModalDiner=u),m(u)}),o(14,"div",10)(15,"div",11)(16,"label",12),_(17,"Nombre del cliente"),a(),o(18,"input",13),S("ngModelChange",function(u){return p(s),M(t.diner.name_client,u)||(t.diner.name_client=u),m(u)}),a()(),o(19,"div",11)(20,"label",14),_(21,"Telefono del cliente"),a(),o(22,"p-inputMask",15),S("ngModelChange",function(u){return p(s),M(t.diner.phone_number,u)||(t.diner.phone_number=u),m(u)}),a()()(),o(23,"div",16)(24,"p-button",17),f("click",function(){return p(s),m(t.saveDiner())}),a()()()}n&2&&(r(2),y(g(17,v)),j("header","Mesa ",t.table==null?null:t.table.name," a nombre de ",t.diner.name_client,""),r(),l("ngIf",t.isLogin),r(),l("ngIf",t.isLogin),r(),l("ngIf",!t.isLogin),r(),l("value",t.items)("rows",10)("paginator",!0),r(7),l("modal",!0),I("visible",t.showModalDiner),r(5),I("ngModel",t.diner.name_client),r(4),y(g(18,v)),I("ngModel",t.diner.phone_number))},dependencies:[W,N,P,re,oe,K,se,G,H,U,ae,le,pe,me,ce,de,_e,ue,ge,z],styles:[".item-cancel[_ngcontent-%COMP%]{background-color:var(--highlight-bg)!important;color:var(--surface-c)!important;text-decoration:line-through;text-decoration-color:#000!important}"]})}}return i})();var Ce=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=k({type:i})}static{this.\u0275inj=A({imports:[B.forChild([{path:"",component:be}]),B]})}}return i})();var ut=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=k({type:i})}static{this.\u0275inj=A({imports:[Ce,he]})}}return i})();export{ut as AttendaceModule};
