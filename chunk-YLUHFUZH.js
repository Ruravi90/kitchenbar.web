import{b as pe,c as _e,d as ue,g as ge,h as he,i as ve,j as fe,n as ye}from"./chunk-73DC43WM.js";import"./chunk-VO7G42AR.js";import{a as ae,g as le,m as de,o as me}from"./chunk-7M5SMTWD.js";import{b as se,c as oe}from"./chunk-7FN5CSOE.js";import{A as ce,b as G,e as H,i as U,q as $,s as ee,t as te,u as ie,w as ne,x as re}from"./chunk-JUBCWWEC.js";import"./chunk-4YRY4IP2.js";import{e as X,g as J,l as K}from"./chunk-AXTF557K.js";import{Ca as j,D as k,Gb as Q,H as B,Ha as D,I as A,Ia as g,Ib as Y,Ja as T,Jb as Z,Ka as F,La as I,Lb as L,Ma as S,Na as M,O as m,P as p,Qa as h,Ra as V,Sa as R,Xa as E,Ya as O,aa as s,ba as v,g as q,ja as f,la as a,na as x,ob as W,pa as r,pb as N,qa as o,qb as P,ra as _,tb as z,va as w,wa as y,xa as c}from"./chunk-RICBQGXD.js";var b=()=>({width:"100%"}),ke=t=>({"p-3":t}),be=t=>({"button-flash":t}),Ae=(t,d)=>({"border-top-1 surface-border":t,"item-cancel":d});function Ve(t,d){t&1&&(r(0,"div",15),_(1,"p-skeleton",16)(2,"p-skeleton",17)(3,"p-skeleton",18)(4,"p-skeleton",19),r(5,"div",20)(6,"ul",21)(7,"li",22)(8,"div",23),_(9,"p-skeleton",24),r(10,"div",25),_(11,"p-skeleton",17)(12,"p-skeleton",26),o()()(),r(13,"li",22)(14,"div",23),_(15,"p-skeleton",24),r(16,"div",25),_(17,"p-skeleton",17)(18,"p-skeleton",26),o()()(),r(19,"li",22)(20,"div",23),_(21,"p-skeleton",24),r(22,"div",25),_(23,"p-skeleton",17)(24,"p-skeleton",26),o()()(),r(25,"li")(26,"div",23),_(27,"p-skeleton",24),r(28,"div",25),_(29,"p-skeleton",17)(30,"p-skeleton",26),o()()()()()())}function Ee(t,d){if(t&1&&(r(0,"div",34)(1,"div",40),g(2),o(),r(3,"div",41),g(4),E(5,"currency"),o()()),t&2){let e=d.$implicit;s(2),T(e.name),s(2),T(O(5,2,e.price))}}function Oe(t,d){if(t&1){let e=w();r(0,"div",34)(1,"div",35)(2,"p-autoComplete",36),M("ngModelChange",function(i){m(e);let l=c(2);return S(l.selectedItem,i)||(l.selectedItem=i),p(i)}),y("onFocus",function(i){m(e);let l=c(2);return p(l.focusSearchMeal(i))})("completeMethod",function(i){m(e);let l=c(2);return p(l.searchMeal(i))})("onSelect",function(i){m(e);let l=c(2);return p(l.completeSelectMeal(i))}),f(3,Ee,6,4,"ng-template",37),o()(),r(4,"div",38)(5,"p-inputNumber",39),M("ngModelChange",function(i){m(e);let l=c(2);return S(l.order.quantity,i)||(l.order.quantity=i),p(i)}),o()()()}if(t&2){let e=c(2);s(2),x(h(14,b)),a("inputStyle",h(15,b)),I("ngModel",e.selectedItem),a("suggestions",e.suggestionsMeal)("dropdown",!0),s(3),x(h(16,b)),a("inputStyle",h(17,b)),I("ngModel",e.order.quantity),a("showButtons",!0)("step",1)("min",1)("max",100)}}function qe(t,d){if(t&1){let e=w();r(0,"div",42)(1,"div",35)(2,"textarea",43),M("ngModelChange",function(i){m(e);let l=c(2);return S(l.order.aditional,i)||(l.order.aditional=i),p(i)}),g(3,"                    "),o()(),r(4,"div",38)(5,"button",44),y("click",function(){m(e);let i=c(2);return p(i.addOrder())}),o()()()}if(t&2){let e=c(2);s(2),x(h(6,b)),a("autoResize",!0),I("ngModel",e.order.aditional),s(3),x(h(7,b))}}function De(t,d){t&1&&(r(0,"div",49),_(1,"p-button",50),o()),t&2&&(s(),x(h(3,b)),a("raised",!0))}function Fe(t,d){if(t&1){let e=w();r(0,"div",42),f(1,De,2,4,"div",45),r(2,"div",46)(3,"p-button",47),y("click",function(){m(e);let i=c(2);return p(i.requestAttendace())}),o()(),r(4,"div",46)(5,"p-button",48),y("click",function(){m(e);let i=c(2);return p(i.requestCheck())}),o()()()}if(t&2){let e=c(2);s(),a("ngIf",!1),s(2),x(h(9,b)),a("raised",!0)("ngClass",V(10,be,e.table==null?null:e.table.isRequestAttendace)),s(2),x(h(12,b)),a("raised",!0)("ngClass",V(13,be,e.table==null?null:e.table.isRequestCheck))}}function Le(t,d){t&1&&_(0,"img",66)}function Be(t,d){t&1&&_(0,"img",67)}function je(t,d){t&1&&_(0,"img",68)}function Re(t,d){t&1&&_(0,"img",69)}function We(t,d){t&1&&_(0,"img",70)}function Ne(t,d){if(t&1){let e=w();r(0,"div",64)(1,"p-button",71),y("onClick",function(i){m(e);let l=c().$implicit,C=c(3);return p(C.changeStatusOrder(i,l))}),o()()}if(t&2){let e=c().$implicit;s(),a("disabled",e.statusOrderId!=3)}}function Pe(t,d){if(t&1){let e=w();r(0,"div",64)(1,"p-button",72),y("onClick",function(){m(e);let i=c().$implicit,l=c(3);return p(l.confirmCancel(i))}),o()()}if(t&2){let e=c().$implicit;s(),a("disabled",e.isCancel||e.statusOrderId>=3)}}function ze(t,d){if(t&1&&(r(0,"div",56)(1,"div",57)(2,"div",41),f(3,Le,1,0,"img",58)(4,Be,1,0,"img",59)(5,je,1,0,"img",60)(6,Re,1,0,"img",61)(7,We,1,0,"img",62),o(),r(8,"div",40)(9,"div",63),g(10),o()(),r(11,"div",64)(12,"div",63),g(13),E(14,"currency"),o()(),f(15,Ne,2,1,"div",65)(16,Pe,2,1,"div",65),o()()),t&2){let e=d.$implicit,n=d.first,i=c(3);s(),a("ngClass",R(12,Ae,!n,e.isCancel)),s(2),a("ngIf",e.isCancel),s(),a("ngIf",e.statusOrderId==1&&!e.isCancel),s(),a("ngIf",e.statusOrderId==2&&!e.isCancel),s(),a("ngIf",e.statusOrderId==3&&!e.isCancel),s(),a("ngIf",e.statusOrderId==4&&!e.isCancel),s(3),T(e.quantity+" "+(e.meal==null?null:e.meal.name)),s(3),T(O(14,10,(e.meal==null?null:e.meal.price)*e.quantity)),s(2),a("ngIf",i.isLogin),s(),a("ngIf",i.isLogin)}}function Ge(t,d){if(t&1){let e=w();r(0,"p-button",73),y("onClick",function(){m(e);let i=c(3);return p(i.confirmCloseTicket())}),g(1,"$ Cerrar cuenta $"),o()}}function He(t,d){if(t&1&&(r(0,"div",51),f(1,ze,17,15,"div",52),r(2,"div",53)(3,"div",34)(4,"div",40)(5,"div",54),g(6),E(7,"currency"),o()(),r(8,"div",41),f(9,Ge,2,0,"p-button",55),o()()()()),t&2){let e=d.$implicit,n=c(2);s(),a("ngForOf",e),s(5),F("Total: ",O(7,3,n.totalOrder)," MXN"),s(3),a("ngIf",n.isLogin)}}function Ue(t,d){if(t&1&&(r(0,"div",27)(1,"div",28)(2,"p-card",29),f(3,Oe,6,18,"div",30)(4,qe,6,8,"div",31)(5,Fe,6,15,"div",31),r(6,"p-dataView",32,1),f(8,He,10,5,"ng-template",33),o()()()()),t&2){let e=c();s(),a("ngClass",V(12,ke,!e.isLogin)),s(),x(h(14,b)),j("header","Mesa ",e.table==null?null:e.table.name," a nombre de ",e.diner.name_client,""),s(),a("ngIf",e.isLogin),s(),a("ngIf",e.isLogin),s(),a("ngIf",!e.isLogin),s(),a("value",e.items)("rows",10)("paginator",!0)}}function Xe(t,d){if(t&1){let e=w();r(0,"div",74)(1,"div",75),_(2,"i",76),o(),r(3,"span",77),g(4),o(),r(5,"p",78),g(6),o(),r(7,"div",79)(8,"button",80),y("click",function(){m(e),c();let i=D(4);return p(i.accept())}),o(),r(9,"button",81),y("click",function(){m(e),c();let i=D(4);return p(i.reject())}),o()()()}if(t&2){let e=d.$implicit;s(4),F(" ",e.header," "),s(2),T(e.message)}}var xe=(()=>{class t{constructor(e,n,i,l,C,u,Ie,Se,Me,Te){this.confirmationService=e,this.messageService=n,this._serviceAuth=i,this._serviceTable=l,this._serviceOrder=C,this._serviceDiner=u,this._serviceMeal=Ie,this.route=Se,this.router=Me,this.hub=Te,this.skeleton=!0,this.items=[],this.order={},this.isLogin=!1,this.totalOrder=0,this.isRequestAttendace=!1,this.isRequestCheck=!1,this.diner={name_client:"Cliente an\xF3nimo"},this.suggestionsMeal=[],this.meals=[],this.tableIdentity="",this.instanceIdentity="",this.showModalDiner=!1,this.isLogin=i.checkLogin()}ngOnInit(){return q(this,null,function*(){this.order.quantity=1,this.order.statusOrderId=1,yield this.delay(1e3),this.tableIdentity=this.route.snapshot.paramMap.get("identity"),this.isLogin||(this.hub.connect(),yield this.delay(1e3),this.hub.newUser().subscribe()),this.getTable(),this.getDiner(),this.isLogin&&this.getMeals(),this.hub.receiveOrderFromTable().subscribe(e=>{"number".includes(typeof this.diner.id)||(this.getDiner(),this.delay(1e3)),this.getOrders()})})}ngOnDestroy(){}delay(e){return q(this,null,function*(){return new Promise(n=>setTimeout(n,e))})}getTable(){this._serviceTable.getByIdentity(this.tableIdentity).subscribe({next:e=>{console.log(e),this.table=e,this.instanceIdentity=e.instance.identity,this.isLogin||this.hub.joinGroupAnonymus(e.instance.identity)},error:e=>{console.log(e),this.messageService.add({severity:"warn",summary:"Alerta",detail:e.error.messages})}})}getOrders(){this.totalOrder=0,this._serviceOrder.getItemsByTable(this.diner.id).subscribe({next:e=>{this.items=e,this.items.forEach(n=>{n.isCancel||(this.totalOrder+=n.meal.price*n.quantity)}),this.skeleton=!1},error:e=>{console.log(e),this.messageService.add({severity:"warn",summary:"Alerta",detail:e.error.messages})}})}getDiner(){this._serviceDiner.getItemsByTable(this.tableIdentity).subscribe({next:e=>{e==null&&this.isLogin?(this.showModalDiner=!0,this.skeleton=!1):(this.diner=e,this.order.dinerId=e.id,this.getOrders())},error:e=>{console.log(e),this.messageService.add({severity:"warn",summary:"Alerta",detail:e.error.messages})}})}getMeals(){this._serviceMeal.getItemsByInstance().subscribe({next:e=>{this.meals=e},error:e=>{console.log(e),this.messageService.add({severity:"warn",summary:"Alerta",detail:e.error.messages})}})}requestAttendace(){this.table.isRequestCheck=!1,this.table.isRequestAttendace=!this.table.isRequestAttendace,this._serviceTable.request(this.table).subscribe({next:()=>{this.hub.sendNotificationTables(this.table)},error:e=>{console.log(e),this.messageService.add({severity:"warn",summary:"Alerta",detail:e.error.messages})}})}requestCheck(){this.table.isRequestCheck=!this.table.isRequestCheck,this.table.isRequestAttendace=!1,this._serviceTable.request(this.table).subscribe({next:()=>{this.hub.sendNotificationTables(this.table)},error:e=>{console.log(e),this.messageService.add({severity:"warn",summary:"Alerta",detail:e.error.messages})}})}focusSearchMeal(e){}searchMeal(e){let n=[],i=e.query;for(let l=0;l<this.meals.length;l++){let C=this.meals[l];C.name.toLowerCase().indexOf(i.toLowerCase())==0&&n.push(C)}this.suggestionsMeal=n}completeSelectMeal(e){this.order={mealId:e.value.id,tableId:this.table?.id,statusOrderId:1,quantity:1}}addOrder(){this.selectedItem&&(this.order.dinerId=this.diner.id,this._serviceOrder.createItem(this.order).subscribe({next:e=>{this.hub.sendOrder(this.order),this.order={},this.order.quantity=1,this.selectedItem=void 0,this.getOrders()},error:e=>{console.log(e),this.messageService.add({severity:"warn",summary:"Alerta",detail:e.error.messages})}}))}cancelOrder(e){e.isCancel=!0,this._serviceOrder.updateItem(e.id,e).subscribe({next:n=>{this.hub.sendOrder(e)},error:n=>{console.log(n),this.messageService.add({severity:"warn",summary:"Alerta",detail:n.error.messages})}})}confirmCancel(e){this.confirmationService.confirm({header:"Estas seguro de cancelar?",message:"Por favor de confirmar.",accept:()=>{this.cancelOrder(e)}})}changeStatusOrder(e,n){this.confirmationService.confirm({target:e.target,message:"",header:"Se entrego el alimento?",accept:()=>{n.statusOrderId=4,this._serviceOrder.updateItem(n.id,n).subscribe({next:i=>{this.hub.sendOrder(n)},error:i=>{console.log(i),this.messageService.add({severity:"warn",summary:"Alerta",detail:i.error.messages})}})}})}confirmCloseTicket(){this.confirmationService.confirm({header:"Estas seguro de cerrar la cuenta?",message:"Por favor de confirmar.",accept:()=>{this._serviceDiner.closeTicket(this.diner.id).subscribe({next:e=>{this.router.navigate(["/kitchen/tables"])},error:e=>{console.log(e),this.messageService.add({severity:"warn",summary:"Alerta",detail:e.error.message})}})}})}saveDiner(){this.table!=null&&(this.diner.tableId=this.table.id,this._serviceDiner.createItem(this.diner).subscribe({next:e=>{console.log("Diner --> ",e),this.diner=e,this.order={},this.order.quantity=1,this.showModalDiner=!1},error:e=>{this.showModalDiner=!0,console.log(e),this.messageService.add({severity:"warn",summary:"Alerta",detail:e.error.messages})}}))}static{this.\u0275fac=function(n){return new(n||t)(v(X),v(J),v($),v(ie),v(te),v(re),v(ee),v(Q),v(Y),v(ne))}}static{this.\u0275cmp=B({type:t,selectors:[["app-attendace"]],decls:19,vars:10,consts:[["cd",""],["dv",""],["class","card w-full m-3",4,"ngIf"],["class","flex flex-wrap justify-content-center ",4,"ngIf"],["pTemplate","headless"],["header","Cliente","closable","false",3,"visibleChange","modal","visible"],[1,"formgrid","grid","gap-3","mb-3","mt-3"],[1,"field","col-12"],["for","name"],["pInputText","","id","name","type","text",1,"w-full",3,"ngModelChange","ngModel"],["for","phone"],["id","phone","mask","99-9999-9999","placeholder","99-9999-9999",3,"ngModelChange","ngModel"],[1,"flex","justify-content-end","gap-2"],["label","Cancelar","severity","secondary",3,"routerLink"],["label","Guardar",3,"click"],[1,"card","w-full","m-3"],["styleClass","mb-2"],["width","100%","styleClass","mb-2"],["width","60%","styleClass","mb-2"],["height","5rem","styleClass","mb-2"],[1,"border-round","border-1","surface-border","p-4","surface-card"],[1,"m-0","p-0","list-none"],[1,"mb-3"],[1,"flex"],["shape","circle","size","4rem","styleClass","mr-2"],[2,"flex","1"],["width","75%"],[1,"flex","flex-wrap","justify-content-center"],[1,"w-full",3,"ngClass"],[3,"header"],["class","grid",4,"ngIf"],["class","grid mb-3",4,"ngIf"],["emptyMessage","Sin ordenes en proceso",3,"value","rows","paginator"],["pTemplate","list"],[1,"grid"],[1,"col-12","md:col-9"],["placeholder","Buscar alimento(s) o bebida(s)","optionLabel","name",3,"ngModelChange","onFocus","completeMethod","onSelect","inputStyle","ngModel","suggestions","dropdown"],["pTemplate","item"],[1,"col-12","md:col-3"],["placeholder","Cantidad","buttonLayout","horizontal","spinnerMode","horizontal","incrementButtonIcon","pi pi-plus","decrementButtonIcon","pi pi-minus",1,"w-full",3,"ngModelChange","inputStyle","ngModel","showButtons","step","min","max"],[1,"col"],[1,"col-fixed"],[1,"grid","mb-3"],["rows","1","cols","30","pInputTextarea","","placeholder","Complementos u/o Observaci\xF3n",3,"ngModelChange","autoResize","ngModel"],["pButton","","pRipple","","icon","pi pi-plus","label","Agregar",3,"click"],["class","col-12 md:col-4",4,"ngIf"],[1,"col-12","md:col-6"],["label","Asistencia","icon","pi pi-bell","severity","info",3,"click","raised","ngClass"],["label","Cuenta","icon","pi pi-check",3,"click","raised","ngClass"],[1,"col-12","md:col-4"],["label","Menu","icon","pi pi-list",3,"raised"],[1,"grid","grid-nogutter"],["class","col-12",4,"ngFor","ngForOf"],[1,"col-12","border-top-1","surface-border","pt-3"],[1,"text-lg","font-medium","text-900","mt-1"],["severity","success","size","small",3,"onClick",4,"ngIf"],[1,"col-12"],[1,"grid",3,"ngClass"],["src","./assets/images/icon/ban.svg","style","width: 25px;",4,"ngIf"],["pTooltip","En proceso","src","./assets/images/icon/process.svg","style","width: 25px;",4,"ngIf"],["pTooltip","Preparando","src","./assets/images/icon/uniform.svg","style","width: 25px;",4,"ngIf"],["pTooltip","Enviado","src","./assets/images/icon/delivery.svg","style","width: 25px;",4,"ngIf"],["pTooltip","Entregado","src","./assets/images/icon/meal.svg","style","width: 25px;",4,"ngIf"],[1,"text-900","mt-1"],[1,"col-fixed","gap-1"],["class","col-fixed gap-1",4,"ngIf"],["src","./assets/images/icon/ban.svg",2,"width","25px"],["pTooltip","En proceso","src","./assets/images/icon/process.svg",2,"width","25px"],["pTooltip","Preparando","src","./assets/images/icon/uniform.svg",2,"width","25px"],["pTooltip","Enviado","src","./assets/images/icon/delivery.svg",2,"width","25px"],["pTooltip","Entregado","src","./assets/images/icon/meal.svg",2,"width","25px"],["pTooltip","Entregar","icon","pi pi-check","severity","success","size","small",3,"onClick","disabled"],["pTooltip","Cancelar","icon","pi pi-ban","severity","danger","size","small",3,"onClick","disabled"],["severity","success","size","small",3,"onClick"],[1,"flex","flex-column","align-items-center","p-5","surface-overlay","border-round"],[1,"border-circle","bg-primary","inline-flex","justify-content-center","align-items-center","h-6rem","w-6rem"],[1,"pi","pi-question","text-5xl"],[1,"font-bold","text-2xl","block","mb-2","mt-4"],[1,"mb-0"],[1,"flex","align-items-center","gap-2","mt-4"],["pButton","","label","Si",1,"w-8rem",3,"click"],["pButton","","label","No",1,"p-button-outlined","w-8rem",3,"click"]],template:function(n,i){if(n&1){let l=w();f(0,Ve,31,0,"div",2)(1,Ue,9,15,"div",3),_(2,"p-toast"),r(3,"p-confirmDialog",null,0),f(5,Xe,10,2,"ng-template",4),o(),r(6,"p-dialog",5),M("visibleChange",function(u){return m(l),S(i.showModalDiner,u)||(i.showModalDiner=u),p(u)}),r(7,"div",6)(8,"div",7)(9,"label",8),g(10,"Nombre del cliente"),o(),r(11,"input",9),M("ngModelChange",function(u){return m(l),S(i.diner.name_client,u)||(i.diner.name_client=u),p(u)}),o()(),r(12,"div",7)(13,"label",10),g(14,"Telefono del cliente"),o(),r(15,"p-inputMask",11),M("ngModelChange",function(u){return m(l),S(i.diner.phone_number,u)||(i.diner.phone_number=u),p(u)}),o()()(),r(16,"div",12),_(17,"p-button",13),r(18,"p-button",14),y("click",function(){return m(l),p(i.saveDiner())}),o()()()}n&2&&(a("ngIf",i.skeleton),s(),a("ngIf",!i.skeleton),s(5),a("modal",!0),I("visible",i.showModalDiner),s(5),I("ngModel",i.diner.name_client),s(4),x(h(9,b)),I("ngModel",i.diner.phone_number),s(2),a("routerLink","/kitchen/tables"))},dependencies:[Z,W,N,P,se,oe,K,ce,G,H,U,ae,de,_e,ue,me,pe,he,ge,le,ve,fe,z],styles:[".item-cancel[_ngcontent-%COMP%]{background-color:var(--highlight-bg)!important;color:var(--surface-c)!important;text-decoration:line-through;text-decoration-color:#000!important}"]})}}return t})();var we=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=A({type:t})}static{this.\u0275inj=k({imports:[L.forChild([{path:"",component:xe}]),L]})}}return t})();var Ct=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=A({type:t})}static{this.\u0275inj=k({imports:[we,ye]})}}return t})();export{Ct as AttendaceModule};
